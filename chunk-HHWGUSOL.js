import{a as Be}from"./chunk-CRCOCWD6.js";import{a as we}from"./chunk-6U2WXJJT.js";import{o as Oe}from"./chunk-OOXC3MXN.js";import{a as Le,b as De,c as Re}from"./chunk-Z7HEBSRN.js";import"./chunk-5SMMQZVJ.js";import{a as Ee}from"./chunk-E7ROQ3IM.js";import{a as ze,b as ke}from"./chunk-IKMWHSPF.js";import{$ as C,$b as he,Ab as d,Bb as b,Cb as ie,Cc as ye,Dc as q,E as N,Ec as Te,Fc as G,Ia as P,Na as ve,R as X,Ra as I,V as J,Xb as fe,Yb as be,a as k,aa as v,ab as S,ac as Pe,b as H,ba as V,bb as i,ca as z,cb as a,db as T,e as Ue,eb as w,f as O,fb as f,gb as u,gc as Me,hc as xe,ic as Ie,kb as ne,mb as M,nb as s,ob as m,pb as _,qb as W,sc as Q,u as Ce,uc as Y,wc as K,xc as L,ya as n,zb as l,zc as Ae}from"./chunk-S7C4YWPX.js";var te=Ue(ze());var D=class D{constructor(t){this.firestore=t;this.collectionName="paiements"}getPaiementsByMarin(t){let e=L(this.firestore,this.collectionName),r=q(e,G("marinId","==",t));return Y(r,{idField:"id"})}addPaiement(t){return O(this,null,function*(){let e=L(this.firestore,this.collectionName);return yield K(e,H(k({},t),{createdAt:new Date}))})}};D.\u0275fac=function(e){return new(e||D)(J(Q))},D.\u0275prov=X({token:D,factory:D.\u0275fac,providedIn:"root"});var Z=D;var R=class R{constructor(t){this.firestore=t;this.calculsSalaireCollection="calculs_salaire"}saveCalculSalaire(t){return O(this,null,function*(){let e=L(this.firestore,this.calculsSalaireCollection);return yield K(e,t)})}updateCalculSalaire(t,e){return O(this,null,function*(){let r=Ae(this.firestore,this.calculsSalaireCollection,t);yield Te(r,k({},e))})}getCalculsBySortieId(t){let e=L(this.firestore,this.calculsSalaireCollection),r=q(e,G("sortiesIds","array-contains",t));return Y(r,{idField:"id"})}getCalculsByBateau(t){let e=L(this.firestore,this.calculsSalaireCollection),r=q(e,G("bateauId","==",t),ye("dateCalcul","desc"));return Y(r,{idField:"id"})}};R.\u0275fac=function(e){return new(e||R)(J(Q))},R.\u0275prov=X({token:R,factory:R.\u0275fac,providedIn:"root"});var ee=R;function He(c,t){c&1&&(i(0,"div",7),T(1,"div",8),i(2,"p"),s(3),l(4,"translate"),a()()),c&2&&(n(3),m(d(4,1,"MESSAGES.LOADING")))}function Xe(c,t){if(c&1){let e=w();i(0,"tr")(1,"td",37),s(2),a(),i(3,"td"),s(4),a(),i(5,"td"),s(6),l(7,"number"),a(),i(8,"td"),s(9),l(10,"number"),a(),i(11,"td",38),s(12),l(13,"number"),a(),i(14,"td",39),s(15),l(16,"number"),a(),i(17,"td",35)(18,"strong"),s(19),l(20,"number"),a()(),i(21,"td")(22,"button",40),f("click",function(){let o=C(e).$implicit,g=u(3);return v(g.enregistrerPaiement(o))}),s(23),l(24,"translate"),l(25,"translate"),a()()()}if(c&2){let e=t.$implicit;n(2),m(e.marinNom),n(2),m(e.part),n(2),_("",b(7,9,e.salaireBrut,"1.2-2")," DT"),n(3),_("",b(10,12,e.primeNuits,"1.2-2")," DT"),n(3),_("",b(13,15,e.totalAvances,"1.2-2")," DT"),n(3),_("",b(16,18,e.totalPaiements,"1.2-2")," DT"),n(4),_("",b(20,21,e.resteAPayer,"1.2-2")," DT"),n(3),S("disabled",e.resteAPayer<=.01),n(),_(" ",e.resteAPayer>.01?d(24,24,"SALAIRES.PAYER"):d(25,26,"SALAIRES.PAYE")," ")}}function Je(c,t){if(c&1){let e=w();i(0,"div",15)(1,"div",16)(2,"h2"),s(3),l(4,"translate"),a(),i(5,"button",17),l(6,"translate"),f("click",function(){C(e);let o=u(2);return v(o.dernierCalcul=null)}),V(),i(7,"svg",18),T(8,"path",19),a()()(),z(),i(9,"div",20)(10,"div",21)(11,"button",22),f("click",function(){C(e);let o=u(2);return v(o.toggleAccordion("summary"))}),i(12,"span"),s(13),l(14,"translate"),a(),V(),i(15,"svg",23),T(16,"path",24),a()(),z(),i(17,"div",25)(18,"div",26)(19,"div",27)(20,"span"),s(21),l(22,"translate"),a(),i(23,"strong",28),s(24),l(25,"number"),i(26,"button",29),f("click",function(){C(e);let o=u(2);return v(o.showRevenueDetails())}),s(27),l(28,"translate"),a()()(),i(29,"div",27)(30,"span"),s(31),l(32,"translate"),a(),i(33,"strong",30),s(34),l(35,"number"),i(36,"button",29),f("click",function(){C(e);let o=u(2);return v(o.showExpenseDetails())}),s(37),l(38,"translate"),a()()(),i(39,"div",27)(40,"span"),s(41),l(42,"translate"),a(),i(43,"strong",31),s(44),l(45,"number"),a()()()()(),i(46,"div",21)(47,"button",22),f("click",function(){C(e);let o=u(2);return v(o.toggleAccordion("sharing"))}),i(48,"span"),s(49),l(50,"translate"),a(),V(),i(51,"svg",23),T(52,"path",24),a()(),z(),i(53,"div",25)(54,"div",26)(55,"div",27)(56,"span"),s(57),l(58,"translate"),a(),i(59,"strong"),s(60),l(61,"number"),a()(),i(62,"div",27)(63,"span"),s(64),l(65,"translate"),a(),i(66,"strong"),s(67),l(68,"number"),a()(),i(69,"div",27)(70,"span"),s(71,"- D\xE9ductions"),a(),i(72,"strong",30),s(73),l(74,"number"),a()(),i(75,"div",32)(76,"span"),s(77),l(78,"translate"),a(),i(79,"strong"),s(80),l(81,"number"),a()()()()(),i(82,"div",21)(83,"button",22),f("click",function(){C(e);let o=u(2);return v(o.toggleAccordion("details"))}),i(84,"span"),s(85),l(86,"translate"),a(),V(),i(87,"svg",23),T(88,"path",24),a()(),z(),i(89,"div",25)(90,"div",33)(91,"table",34)(92,"thead")(93,"tr")(94,"th"),s(95),l(96,"translate"),a(),i(97,"th"),s(98),l(99,"translate"),a(),i(100,"th"),s(101),l(102,"translate"),a(),i(103,"th"),s(104),l(105,"translate"),a(),i(106,"th"),s(107),l(108,"translate"),a(),i(109,"th"),s(110),l(111,"translate"),a(),i(112,"th",35),s(113),l(114,"translate"),a(),i(115,"th"),s(116),l(117,"translate"),a()()(),i(118,"tbody"),I(119,Xe,26,28,"tr",36),a()()()()()()()}if(c&2){let e=u(2);n(3),W("",d(4,42,"SALAIRES.RESULTS.TITLE")," : ",e.dernierCalcul.sortiesDestinations.join(", ")),n(2),S("title",d(6,44,"SALAIRES.RESULTS.CLOSE")),n(8),m(d(14,46,"SALAIRES.RESULTS.FINANCIAL_SUMMARY")),n(2),M("rotate",e.accordionState.summary),n(2),M("open",e.accordionState.summary),n(4),m(d(22,48,"SALAIRES.REVENU_TOTAL")),n(3),_(" ",b(25,50,e.dernierCalcul.revenuTotal,"1.2-2")," DT "),n(3),_("(",d(28,53,"COMMON.VIEW_DETAILS"),")"),n(4),m(d(32,55,"SALAIRES.TOTAL_DEPENSES")),n(3),_(" ",b(35,57,e.dernierCalcul.totalDepenses,"1.2-2")," DT "),n(3),_("(",d(38,60,"COMMON.VIEW_DETAILS"),")"),n(4),m(d(42,62,"SALAIRES.BENEFICE_NET")),n(3),_("",b(45,64,e.dernierCalcul.beneficeNet,"1.2-2")," DT"),n(5),m(d(50,67,"SALAIRES.RESULTS.PROFIT_SHARING")),n(2),M("rotate",e.accordionState.sharing),n(2),M("open",e.accordionState.sharing),n(4),m(d(58,69,"SALAIRES.PART_PROPRIETAIRE")),n(3),_("",b(61,71,e.dernierCalcul.partProprietaire,"1.2-2")," DT"),n(4),m(d(65,74,"SALAIRES.PART_EQUIPAGE")),n(3),_("",b(68,76,e.dernierCalcul.partEquipage,"1.2-2")," DT"),n(6),_("",b(74,79,e.dernierCalcul.deductionNuits,"1.2-2")," DT"),n(4),m(d(78,82,"SALAIRES.MONTANT_A_PARTAGER")),n(3),_("",b(81,84,e.dernierCalcul.montantAPartager,"1.2-2")," DT"),n(5),m(d(86,87,"SALAIRES.DETAILS_PAR_MARIN")),n(2),M("rotate",e.accordionState.details),n(2),M("open",e.accordionState.details),n(6),m(d(96,89,"SAILORS.TITLE")),n(3),m(d(99,91,"SAILORS.PART")),n(3),m(d(102,93,"SALAIRES.SALAIRE_BASE")),n(3),m(d(105,95,"SALAIRES.PRIME_NUITS")),n(3),m(d(108,97,"AVANCES.TITLE")),n(3),m(d(111,99,"SALAIRES.DEJA_PAYE")),n(3),m(d(114,101,"SALAIRES.RESTE_A_PAYER")),n(3),m(d(117,103,"BOATS.ACTIONS")),n(3),S("ngForOf",e.dernierCalcul.detailsMarins)}}function We(c,t){if(c&1){let e=w();i(0,"div",49),f("click",function(){let o=C(e).$implicit,g=u(5);return v(g.toggleSortie(o.id))}),i(1,"input",50),f("change",function(){let o=C(e).$implicit,g=u(5);return v(g.toggleSortie(o.id))}),a(),i(2,"div",51)(3,"strong"),s(4),a(),i(5,"span"),s(6),a()()()}if(c&2){let e=t.$implicit,r=u(5);M("selected",r.isSortieSelected(e.id)),n(),S("checked",r.isSortieSelected(e.id)),n(3),m(e.destination),n(2),W("",r.formatDate(e.dateDepart)," - ",r.formatDate(e.dateRetour))}}function Qe(c,t){if(c&1&&(i(0,"div",47),I(1,We,7,6,"div",48),a()),c&2){let e=u(4);n(),S("ngForOf",e.sortiesOuvertes)}}function Ke(c,t){c&1&&(i(0,"div",52)(1,"p"),s(2),l(3,"translate"),a()()),c&2&&(n(2),m(d(3,1,"SALAIRES.NO_OPEN_TRIPS")))}function Ze(c,t){if(c&1){let e=w();i(0,"div",42)(1,"div",43)(2,"h2"),s(3),l(4,"translate"),a(),I(5,Qe,2,1,"div",44)(6,Ke,4,3,"ng-template",null,0,ie),i(8,"button",45),f("click",function(){C(e);let o=u(3);return v(o.calculerSalaires())}),V(),i(9,"svg",18),T(10,"path",46),a(),s(11),l(12,"translate"),a()()()}if(c&2){let e=ne(7),r=u(3);n(3),m(d(4,5,"SORTIES.SELECTSORTIES")),n(2),S("ngIf",r.sortiesOuvertes.length>0)("ngIfElse",e),n(3),S("disabled",r.selectedSortiesIds.length===0||r.marins.length===0),n(3),_(" ",d(12,7,"SALAIRES.CALCULER")," ")}}function et(c,t){if(c&1){let e=w();i(0,"div",56)(1,"div",51)(2,"strong"),s(3),a(),i(4,"span"),s(5),l(6,"translate"),a()(),i(7,"button",57),f("click",function(){let o=C(e).$implicit,g=u(5);return v(g.displayCorrectedCalcul(o))}),s(8),l(9,"translate"),a()()}if(c&2){let e=t.$implicit,r=u(5);n(3),m(e.sortiesDestinations.join(" + ")),n(2),W("",d(6,4,"SALAIRES_HISTORY.CALCULATED_ON")," ",r.formatDate(e.dateCalcul)),n(3),m(d(9,6,"COMMON.VIEW_DETAILS"))}}function tt(c,t){if(c&1&&(i(0,"div",54),I(1,et,10,8,"div",55),a()),c&2){let e=u(4);n(),S("ngForOf",e.historiqueCalculs)}}function nt(c,t){c&1&&(i(0,"div",52)(1,"p"),s(2),l(3,"translate"),a()()),c&2&&(n(2),m(d(3,1,"SALAIRES.NO_CALCULATED_TRIPS")))}function it(c,t){if(c&1&&(i(0,"div",42)(1,"div",43)(2,"h2"),s(3),l(4,"translate"),a(),I(5,tt,2,1,"div",53)(6,nt,4,3,"ng-template",null,1,ie),a()()),c&2){let e=ne(7),r=u(3);n(3),m(d(4,3,"SALAIRES.TABS.CALCULATED_TRIPS")),n(2),S("ngIf",r.historiqueCalculs.length>0)("ngIfElse",e)}}function at(c,t){if(c&1&&(i(0,"div"),I(1,Ze,13,9,"div",41)(2,it,8,5,"div",41),a()),c&2){let e=u(2);n(),S("ngIf",e.activeTab==="ouvertes"),n(),S("ngIf",e.activeTab==="historique")}}function rt(c,t){if(c&1){let e=w();i(0,"div",9)(1,"div",10)(2,"button",11),f("click",function(){C(e);let o=u();return v(o.selectTab("ouvertes"))}),s(3),l(4,"translate"),i(5,"span",12),s(6),a()(),i(7,"button",11),f("click",function(){C(e);let o=u();return v(o.selectTab("historique"))}),s(8),l(9,"translate"),i(10,"span",12),s(11),a()()(),I(12,Je,120,105,"div",13)(13,at,3,2,"div",14),a()}if(c&2){let e=u();n(2),M("active",e.activeTab==="ouvertes"),n(),_(" ",d(4,10,"SALAIRES.TABS.OPEN_TRIPS")," "),n(3),m(e.sortiesOuvertes.length),n(),M("active",e.activeTab==="historique"),n(),_(" ",d(9,12,"SALAIRES.TABS.HISTORY")," "),n(3),m(e.historiqueCalculs.length),n(),S("ngIf",e.dernierCalcul),n(),S("ngIf",!e.dernierCalcul)}}var F=class F{constructor(t,e,r,o,g,A,j,$,x,B){this.sortieService=t;this.marinService=e;this.depenseService=r;this.avanceService=o;this.paiementService=g;this.factureService=A;this.salaireService=j;this.selectedBoatService=$;this.alertService=x;this.translate=B;this.selectedBoat=null;this.marins=[];this.selectedSortiesIds=[];this.activeTab="ouvertes";this.sortiesOuvertes=[];this.historiqueCalculs=[];this.allBoatSorties=[];this.dernierCalcul=null;this.accordionState={summary:!0,sharing:!0,details:!0};this.loading=!0}ngOnInit(){this.selectedBoat=this.selectedBoatService.getSelectedBoat(),this.selectedBoat?this.loadData():this.loading=!1}loadData(){if(!this.selectedBoat?.id)return;this.loading=!0;let t=this.selectedBoat.id;Ce([this.sortieService.getSortiesByBateau(t),this.marinService.getMarinsByBateau(t),this.salaireService.getCalculsByBateau(t)]).subscribe(([e,r,o])=>{this.allBoatSorties=e,this.sortiesOuvertes=e.filter(g=>g.statut==="terminee"&&!g.salaireCalcule),this.marins=r,this.historiqueCalculs=o.sort((g,A)=>(A.dateCalcul.toDate?A.dateCalcul.toDate():new Date(A.dateCalcul)).getTime()-(g.dateCalcul.toDate?g.dateCalcul.toDate():new Date(g.dateCalcul)).getTime()),this.loading=!1})}selectTab(t){this.activeTab=t,this.dernierCalcul=null}toggleSortie(t){this.dernierCalcul=null;let e=this.selectedSortiesIds.indexOf(t);e>-1?this.selectedSortiesIds.splice(e,1):this.selectedSortiesIds.push(t)}isSortieSelected(t){return this.selectedSortiesIds.includes(t)}calculerSalaires(){return O(this,null,function*(){if(this.selectedSortiesIds.length===0){this.alertService.error(this.translate.instant("SALAIRES.ERROR_NO_SORTIE"));return}let t=this.marins.reduce((e,r)=>e+(r.part||0),0);if(t<=0){this.alertService.error(this.translate.instant("SALAIRES.ERROR_NO_PARTS"));return}try{this.alertService.loading(this.translate.instant("MESSAGES.CALCULATING"));let e=this.allBoatSorties.filter(p=>this.selectedSortiesIds.includes(p.id)),r=this.selectedSortiesIds.map(p=>this.factureService.getFacturesBySortie(p).pipe(N(1)).toPromise()),o=yield Promise.all(r),g=o.flat().reduce((p,E)=>p+(E?.montant||0),0),A=this.selectedSortiesIds.map(p=>this.depenseService.getDepensesBySortie(p).pipe(N(1)).toPromise()),j=yield Promise.all(A),$=j.flat().reduce((p,E)=>p+(E?.montant||0),0),x=g-$,B=x*.5,ae=x*.5,re=e.reduce((p,E)=>p+this.calculerNombreNuits(E),0),oe=re*this.marins.length*5,se=ae-oe,le=yield this.salaireService.getCalculsByBateau(this.selectedBoat.id).pipe(N(1)).toPromise(),ce=[],de=[];for(let p of this.marins){let E=p.part||0,ue=t>0?se*E/t:0,ge=re*5,Fe=new Date(0);if(le){let h=le.filter(y=>y.detailsMarins.some(U=>U.marinId===p.id));h.length>0&&(h.sort((y,U)=>(U.dateCalcul.toDate?U.dateCalcul.toDate():new Date(U.dateCalcul)).getTime()-(y.dateCalcul.toDate?y.dateCalcul.toDate():new Date(y.dateCalcul)).getTime()),Fe=h[0].dateCalcul.toDate?h[0].dateCalcul.toDate():new Date(h[0].dateCalcul))}let _e=(yield this.avanceService.getAvancesByMarin(p.id).pipe(N(1)).toPromise())?.filter(h=>!h.calculSalaireId)||[],Se=_e.reduce((h,y)=>h+y.montant,0)||0,je=0,$e=ue+ge-Se;ce.push({marinId:p.id,marinNom:`${p.prenom} ${p.nom}`,part:E,salaireBrut:ue,primeNuits:ge,totalAvances:Se,totalPaiements:je,resteAPayer:$e}),_e.forEach(h=>de.push({avanceId:h.id,calculId:""}))}let me={bateauId:this.selectedBoat.id,sortiesIds:this.selectedSortiesIds,sortiesDestinations:e.map(p=>p.destination),dateCalcul:new Date,revenuTotal:g,totalDepenses:$,beneficeNet:x,partProprietaire:B,partEquipage:ae,deductionNuits:oe,montantAPartager:se,detailsMarins:ce,factures:o.flat(),depenses:j.flat()},pe=yield this.salaireService.saveCalculSalaire(me);for(let p of de)yield this.avanceService.updateAvance(p.avanceId,{calculSalaireId:pe.id});for(let p of this.selectedSortiesIds)yield this.sortieService.updateSortie(p,{salaireCalcule:!0});this.alertService.close(),this.dernierCalcul=H(k({},me),{id:pe.id}),this.accordionState={summary:!0,sharing:!0,details:!0},this.selectedSortiesIds=[],this.loadData(),this.alertService.toast(this.translate.instant("SALAIRES.CALCUL_SUCCESS_TITLE"),"success")}catch(e){console.error("Erreur:",e),this.alertService.close(),this.alertService.error()}})}reopenSortieForRecalculation(t){return O(this,null,function*(){try{this.alertService.loading(this.translate.instant("MESSAGES.UPDATING")),yield this.sortieService.updateSortie(t.id,{salaireCalcule:!1}),this.loadData(),this.activeTab="ouvertes",this.alertService.success(this.translate.instant("SALAIRES.HISTORY.MOVED_FOR_RECALC"))}catch(e){console.error(e),this.alertService.error()}})}displayCorrectedCalcul(t){return O(this,null,function*(){this.alertService.loading(this.translate.instant("MESSAGES.LOADING_DETAILS"));let e=JSON.parse(JSON.stringify(t)),r=e.sortiesIds||[];for(let o of e.detailsMarins){let j=((yield this.paiementService.getPaiementsByMarin(o.marinId).pipe(N(1)).toPromise())||[]).filter(x=>x.sortiesIds&&x.sortiesIds.some(B=>r.includes(B))).reduce((x,B)=>x+B.montant,0);o.totalPaiements=j;let $=o.salaireBrut+o.primeNuits;o.resteAPayer=$-o.totalAvances-o.totalPaiements}this.dernierCalcul=e,this.accordionState={summary:!0,sharing:!0,details:!0},this.activeTab="historique",this.alertService.close(),window.scrollTo({top:0,behavior:"smooth"})})}showRevenueDetails(){if(!this.dernierCalcul||!this.dernierCalcul.factures)return;let t={title:this.translate.instant("SALAIRES.DETAILS_MODAL.REVENUE_TITLE"),invoiceNum:this.translate.instant("SALAIRES.DETAILS_MODAL.INVOICE_NUM"),client:this.translate.instant("SALAIRES.DETAILS_MODAL.CLIENT"),date:this.translate.instant("COMMON.DATE"),amount:this.translate.instant("COMMON.AMOUNT")},e=this.dernierCalcul.factures.map(o=>`<tr><td>${o.numeroFacture}</td><td>${o.client}</td><td>${this.formatDate(o.dateVente)}</td><td class="amount">${o.montant.toFixed(2)} DT</td></tr>`).join(""),r=`<div class="details-modal-content"><table class="details-table"><thead><tr><th>${t.invoiceNum}</th><th>${t.client}</th><th>${t.date}</th><th class="amount">${t.amount}</th></tr></thead><tbody>${e}</tbody></table></div>`;te.default.fire({title:t.title,html:r,width:"800px",showCloseButton:!0,showConfirmButton:!1})}showExpenseDetails(){if(!this.dernierCalcul||!this.dernierCalcul.depenses)return;let t={title:this.translate.instant("SALAIRES.DETAILS_MODAL.EXPENSE_TITLE"),type:this.translate.instant("EXPENSES.TYPE"),date:this.translate.instant("COMMON.DATE"),description:this.translate.instant("COMMON.DESCRIPTION"),amount:this.translate.instant("COMMON.AMOUNT")},e=this.dernierCalcul.depenses.map(o=>`<tr><td>${this.translate.instant("EXPENSES.TYPES."+o.type.toUpperCase())}</td><td>${this.formatDate(o.date)}</td><td>${o.description||"-"}</td><td class="amount">${o.montant.toFixed(2)} DT</td></tr>`).join(""),r=`<div class="details-modal-content"><table class="details-table"><thead><tr><th>${t.type}</th><th>${t.date}</th><th>${t.description}</th><th class="amount">${t.amount}</th></tr></thead><tbody>${e}</tbody></table></div>`;te.default.fire({title:t.title,html:r,width:"800px",showCloseButton:!0,showConfirmButton:!1})}enregistrerPaiement(t){return O(this,null,function*(){let{value:e}=yield te.default.fire({title:this.translate.instant("SALAIRES.PAYMENT_MODAL_TITLE",{name:t.marinNom}),input:"number",inputLabel:this.translate.instant("SALAIRES.PAYMENT_MODAL_LABEL",{amount:t.resteAPayer.toFixed(2)}),inputValue:t.resteAPayer>0?t.resteAPayer.toFixed(2):0,showCancelButton:!0,confirmButtonText:this.translate.instant("FORM.SAVE"),cancelButtonText:this.translate.instant("FORM.CANCEL"),confirmButtonColor:"#10b981",inputValidator:r=>{if(!r)return this.translate.instant("FORM.REQUIRED");let o=parseFloat(r);return o<=0?this.translate.instant("SALAIRES.PAYMENTMODAL.ERRORPOSITIVE"):o>t.resteAPayer+.01?this.translate.instant("SALAIRES.PAYMENTMODAL.ERROREXCEED"):null}});if(e)try{this.alertService.loading(this.translate.instant("MESSAGES.SAVING"));let r=parseFloat(e);yield this.paiementService.addPaiement({marinId:t.marinId,montant:r,datePaiement:new Date,sortiesIds:this.dernierCalcul.sortiesIds}),t.totalPaiements+=r;let o=t.salaireBrut+t.primeNuits;t.resteAPayer=o-t.totalAvances-t.totalPaiements,Math.abs(t.resteAPayer)<.01&&(t.resteAPayer=0),this.dernierCalcul&&this.dernierCalcul.id&&(yield this.salaireService.updateCalculSalaire(this.dernierCalcul.id,{detailsMarins:this.dernierCalcul.detailsMarins})),this.alertService.success(this.translate.instant("SALAIRES.PAYMENT_SUCCESS"))}catch(r){console.error("Erreur:",r),this.alertService.error()}})}calculerNombreNuits(t){if(!t?.dateDepart||!t?.dateRetour)return 0;let e=t.dateDepart.toDate?t.dateDepart.toDate():new Date(t.dateDepart),r=t.dateRetour.toDate?t.dateRetour.toDate():new Date(t.dateRetour),o=Math.abs(r.getTime()-e.getTime());return Math.ceil(o/(1e3*60*60*24))}formatDate(t){return t?.toDate?t.toDate().toLocaleDateString("fr-FR"):t instanceof Date?t.toLocaleDateString("fr-FR"):""}toggleAccordion(t){this.accordionState[t]=!this.accordionState[t]}};F.\u0275fac=function(e){return new(e||F)(P(Re),P(we),P(Le),P(Be),P(Z),P(De),P(ee),P(Ee),P(ke),P(Me))},F.\u0275cmp=ve({type:F,selectors:[["app-salaires-list"]],decls:7,vars:5,consts:[["noOpenTrips",""],["noCalculatedTrips",""],[1,"salaires-container"],[1,"header"],[1,"title"],["class","loading",4,"ngIf"],["class","content",4,"ngIf"],[1,"loading"],[1,"spinner"],[1,"content"],[1,"tabs"],[1,"tab-button",3,"click"],[1,"badge"],["class","results-container",4,"ngIf"],[4,"ngIf"],[1,"results-container"],[1,"results-header"],[1,"btn-close-results",3,"click","title"],["fill","none","viewBox","0 0 24 24","stroke","currentColor"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"accordion"],[1,"accordion-item"],[1,"accordion-header",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"chevron"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"accordion-content"],[1,"summary-grid"],[1,"summary-item"],[1,"revenue"],[1,"details-link",3,"click"],[1,"expenses"],[1,"benefit"],[1,"summary-item","net-share"],[1,"table-container"],[1,"salaires-table"],[1,"reste"],[4,"ngFor","ngForOf"],[1,"marin-name"],[1,"avances"],[1,"paiements"],[1,"btn","btn-sm","btn-pay",3,"click","disabled"],["class","tab-content",4,"ngIf"],[1,"tab-content"],[1,"section-card"],["class","sorties-list",4,"ngIf","ngIfElse"],[1,"btn","btn-success","btn-lg",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"],[1,"sorties-list"],["class","sortie-item",3,"selected","click",4,"ngFor","ngForOf"],[1,"sortie-item",3,"click"],["type","checkbox",3,"change","checked"],[1,"sortie-info"],[1,"no-data-small"],["class","sorties-list-history",4,"ngIf","ngIfElse"],[1,"sorties-list-history"],["class","sortie-item-history",4,"ngFor","ngForOf"],[1,"sortie-item-history"],[1,"btn","btn-secondary","btn-sm",3,"click"]],template:function(e,r){e&1&&(i(0,"div",2)(1,"div",3)(2,"h1",4),s(3),l(4,"translate"),a()(),I(5,He,5,3,"div",5)(6,rt,14,14,"div",6),a()),e&2&&(n(3),m(d(4,3,"SALAIRES.TITLE")),n(2),S("ngIf",r.loading),n(),S("ngIf",!r.loading&&r.selectedBoat))},dependencies:[Pe,fe,be,Oe,Ie,he,xe],styles:['@charset "UTF-8";.salaires-container[_ngcontent-%COMP%]{max-width:1600px;margin:0 auto;padding:2rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;flex-wrap:wrap;gap:1rem}.title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#1f2937;margin:0}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;border:none;border-radius:.5rem;font-weight:600;cursor:pointer;transition:all .3s}.btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2563eb;transform:translateY(-2px)}.btn-success[_ngcontent-%COMP%]{background-color:#10b981;color:#fff}.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#059669;transform:translateY(-2px)}.btn-lg[_ngcontent-%COMP%]{padding:1rem 2rem;font-size:1.125rem;margin-top:1.5rem}.btn-sm[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.875rem}.btn-pay[_ngcontent-%COMP%]{background-color:#10b981;color:#fff}.btn-pay[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#059669}.btn-pay[_ngcontent-%COMP%]:disabled{background-color:#9ca3af}.loading[_ngcontent-%COMP%]{text-align:center;padding:3rem}.loading[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;margin:0 auto 1rem;border:4px solid #f3f4f6;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.no-data[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#9ca3af}.no-data[_ngcontent-%COMP%]   .no-data-icon[_ngcontent-%COMP%]{width:64px;height:64px;margin:0 auto 1rem;opacity:.5}.section-card[_ngcontent-%COMP%]{background:#fff;border-radius:.75rem;padding:2rem;box-shadow:0 1px 3px #0000001a;margin-bottom:2rem}.section-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#1f2937;margin:0 0 1.5rem}.sorties-list[_ngcontent-%COMP%]{display:grid;gap:1rem;margin-bottom:1.5rem}.sortie-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;border:2px solid #e5e7eb;border-radius:.5rem;cursor:pointer;transition:all .3s}.sortie-item[_ngcontent-%COMP%]:hover{border-color:#3b82f6;background-color:#f9fafb}.sortie-item.selected[_ngcontent-%COMP%]{border-color:#10b981;background-color:#d1fae5}.sortie-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:20px;height:20px}.sortie-item[_ngcontent-%COMP%]   .sortie-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.sortie-item[_ngcontent-%COMP%]   .sortie-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#1f2937}.sortie-item[_ngcontent-%COMP%]   .sortie-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280}.sortie-item[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:.375rem;font-size:.875rem;font-weight:600}.sortie-item[_ngcontent-%COMP%]   .status-en-cours[_ngcontent-%COMP%]{background-color:#dbeafe;color:#1e40af}.sortie-item[_ngcontent-%COMP%]   .status-terminee[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-bottom:2rem}.summary-card[_ngcontent-%COMP%]{background:#fff;border-radius:.75rem;padding:1.5rem;box-shadow:0 1px 3px #0000001a}.summary-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#6b7280;margin:0 0 .5rem;text-transform:uppercase;letter-spacing:.05em}.summary-card[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;margin:0}.summary-card[_ngcontent-%COMP%]   .amount.big[_ngcontent-%COMP%]{font-size:2.25rem}.summary-card[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280;margin:.25rem 0 0}.summary-card.revenue[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:#10b981}.summary-card.expenses[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:#ef4444}.summary-card.benefit[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:#3b82f6}.summary-card.owner[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}.summary-card.owner[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .summary-card.owner[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:#fff}.summary-card.crew[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);color:#fff}.summary-card.crew[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .summary-card.crew[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%], .summary-card.crew[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]{color:#fff}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.salaires-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.salaires-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#f9fafb}.salaires-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;font-weight:600;color:#374151;border-bottom:2px solid #e5e7eb;white-space:nowrap}.salaires-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th.reste[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #e5e7eb}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;color:#6b7280}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.marin-name[_ngcontent-%COMP%]{font-weight:600;color:#1f2937}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.avances[_ngcontent-%COMP%]{color:#ef4444}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.paiements[_ngcontent-%COMP%]{color:#3b82f6}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.reste[_ngcontent-%COMP%]{background-color:#f0fdf4;font-size:1.125rem}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.reste[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#059669}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.reste.paid[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#9ca3af}@media (max-width: 768px){.salaires-container[_ngcontent-%COMP%]{padding:1rem}.title[_ngcontent-%COMP%]{font-size:1.5rem}.summary-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}.table-container[_ngcontent-%COMP%]{overflow-x:scroll}.salaires-table[_ngcontent-%COMP%]{font-size:.875rem}}.tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;border-bottom:2px solid #e5e7eb;margin-bottom:2rem}.tab-button[_ngcontent-%COMP%]{padding:1rem 1.5rem;border:none;background:none;font-size:1rem;font-weight:600;color:#6b7280;cursor:pointer;transition:all .3s;border-bottom:4px solid transparent;display:flex;align-items:center;gap:.5rem}.tab-button[_ngcontent-%COMP%]:hover{color:#1f2937;background-color:#f9fafb}.tab-button.active[_ngcontent-%COMP%]{color:#10b981;border-bottom-color:#10b981}.badge[_ngcontent-%COMP%]{background-color:#e5e7eb;color:#4b5563;border-radius:9999px;padding:.125rem .625rem;font-size:.75rem;font-weight:700}.tab-button.active[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background-color:#10b981;color:#fff}.no-data-small[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#9ca3af;font-style:italic}.sorties-list-history[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.sortie-item-history[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#f9fafb;border:1px solid #e5e7eb;border-radius:.5rem}.btn-secondary[_ngcontent-%COMP%]{background-color:#6b7280;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#4b5563}.calcul-details-popup[_ngcontent-%COMP%]   .swal2-html-container[_ngcontent-%COMP%]{padding:0!important;margin:1rem 0 0!important}.swal-calcul-details[_ngcontent-%COMP%]{text-align:left}.swal-calcul-details[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%], .swal-calcul-details[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{margin-bottom:1.5rem}.swal-calcul-details[_ngcontent-%COMP%]   .salaires-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .swal-calcul-details[_ngcontent-%COMP%]   .salaires-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem}.results-container[_ngcontent-%COMP%]{background-color:#f9fafb;border:1px solid #e5e7eb;border-radius:.75rem;padding:1.5rem;margin-top:2rem;animation:_ngcontent-%COMP%_fadeIn .5s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.results-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.results-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:#10b981}.btn-close-results[_ngcontent-%COMP%]{background:#e5e7eb;border:none;border-radius:9999px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.btn-close-results[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px;color:#6b7280}.btn-close-results[_ngcontent-%COMP%]:hover{background:#d1d5db;transform:rotate(90deg)}.accordion[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.accordion-item[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:.5rem;overflow:hidden}.accordion-header[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border:none;background:none;cursor:pointer;font-size:1.125rem;font-weight:600;color:#1f2937}.accordion-header[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{width:20px;height:20px;color:#9ca3af;transition:transform .3s ease}.accordion-header[_ngcontent-%COMP%]   .chevron.rotate[_ngcontent-%COMP%]{transform:rotate(180deg)}.accordion-content[_ngcontent-%COMP%]{max-height:0;overflow:hidden;transition:max-height .4s ease-out,padding .4s ease-out;padding:0 1.5rem}.accordion-content.open[_ngcontent-%COMP%]{max-height:2000px;padding:1.5rem;padding-top:0;transition:max-height .5s ease-in,padding .5s ease-in}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}.summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{background:#f9fafb;padding:1rem;border-radius:.5rem;display:flex;justify-content:space-between;align-items:center}.summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#6b7280}.summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.25rem}.summary-grid[_ngcontent-%COMP%]   .summary-item.net-share[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .summary-grid[_ngcontent-%COMP%]   .revenue[_ngcontent-%COMP%]{color:#10b981}.summary-grid[_ngcontent-%COMP%]   .expenses[_ngcontent-%COMP%]{color:#ef4444}.summary-grid[_ngcontent-%COMP%]   .benefit[_ngcontent-%COMP%]{color:#3b82f6}.details-link[_ngcontent-%COMP%]{background:none;border:none;color:#3b82f6;text-decoration:underline;cursor:pointer;font-size:.8rem;margin-left:.5rem;padding:0}.details-link[_ngcontent-%COMP%]:hover{color:#1d4ed8}.summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:flex;align-items:center}.details-modal-content[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto;padding:1rem 0}.details-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.details-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .details-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;text-align:left;border-bottom:1px solid #e5e7eb}.details-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f9fafb;font-weight:600}.details-table[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{text-align:right;font-weight:600;white-space:nowrap}.btn-pay[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.btn-pay[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2563eb}.btn-pay[_ngcontent-%COMP%]:disabled{background-color:#d1d5db;cursor:not-allowed}']});var Ve=F;export{Ve as SalairesListComponent};
