import{o as ve}from"./chunk-RWAEN67H.js";import{a as we}from"./chunk-SYBESGVH.js";import{a as Te}from"./chunk-XT4HNBRJ.js";import{a as Ie,b as Ae,c as ye}from"./chunk-MYMIL53V.js";import{a as Ee}from"./chunk-S4VOV2ZB.js";import"./chunk-ATU6D4XS.js";import{a as Oe}from"./chunk-3BHKDQAO.js";import{a as Ne}from"./chunk-MYU4GBB5.js";import{$ as S,$b as fe,Ab as C,Bb as ee,Cc as Me,Dc as k,E as w,Ec as xe,Fc as N,Ia as O,Na as ue,R as $,Ra as M,V as Y,Wb as ge,Xb as _e,_b as Se,a as U,aa as f,ab as _,b as pe,ba as L,bb as a,ca as D,cb as r,db as E,e as ke,eb as I,f as h,fb as v,fc as Ce,gb as u,gc as be,hc as he,kb as Z,mb as P,nb as o,ob as m,pb as g,qb as z,sc as G,uc as B,wc as q,xc as A,ya as n,yb as c,zb as d,zc as Pe}from"./chunk-O6FOITNJ.js";var V=ke(Ne());var y=class y{constructor(t){this.firestore=t;this.collectionName="paiements"}getPaiementsByMarin(t){let e=A(this.firestore,this.collectionName),i=k(e,N("marinId","==",t));return B(i,{idField:"id"})}addPaiement(t){return h(this,null,function*(){let e=A(this.firestore,this.collectionName);return yield q(e,pe(U({},t),{createdAt:new Date}))})}};y.\u0275fac=function(e){return new(e||y)(Y(G))},y.\u0275prov=$({token:y,factory:y.\u0275fac,providedIn:"root"});var H=y;var T=class T{constructor(t){this.firestore=t;this.calculsSalaireCollection="calculs_salaire"}saveCalculSalaire(t){return h(this,null,function*(){let e=A(this.firestore,this.calculsSalaireCollection);return yield q(e,t)})}updateCalculSalaire(t,e){return h(this,null,function*(){let i=Pe(this.firestore,this.calculsSalaireCollection,t);yield xe(i,U({},e))})}getCalculsBySortieId(t){let e=A(this.firestore,this.calculsSalaireCollection),i=k(e,N("sortiesIds","array-contains",t));return B(i,{idField:"id"})}getCalculsByBateau(t){let e=A(this.firestore,this.calculsSalaireCollection),i=k(e,N("bateauId","==",t),Me("dateCalcul","desc"));return B(i,{idField:"id"})}};T.\u0275fac=function(e){return new(e||T)(Y(G))},T.\u0275prov=$({token:T,factory:T.\u0275fac,providedIn:"root"});var X=T;function Ue(l,t){l&1&&(a(0,"div",7),E(1,"div",8),a(2,"p"),o(3),c(4,"translate"),r()()),l&2&&(n(3),m(d(4,1,"MESSAGES.LOADING")))}function $e(l,t){if(l&1){let e=I();a(0,"tr")(1,"td",37),o(2),r(),a(3,"td"),o(4),r(),a(5,"td"),o(6),c(7,"number"),r(),a(8,"td"),o(9),c(10,"number"),r(),a(11,"td",38),o(12),c(13,"number"),r(),a(14,"td",39),o(15),c(16,"number"),r(),a(17,"td",35)(18,"strong"),o(19),c(20,"number"),r()(),a(21,"td")(22,"button",40),v("click",function(){let s=S(e).$implicit,b=u(3);return f(b.enregistrerPaiement(s))}),o(23),c(24,"translate"),c(25,"translate"),r()()()}if(l&2){let e=t.$implicit;n(2),m(e.marinNom),n(2),m(e.part),n(2),g("",C(7,9,e.salaireBrut,"1.2-2")," DT"),n(3),g("",C(10,12,e.primeNuits,"1.2-2")," DT"),n(3),g("",C(13,15,e.totalAvances,"1.2-2")," DT"),n(3),g("",C(16,18,e.totalPaiements,"1.2-2")," DT"),n(4),g("",C(20,21,e.resteAPayer,"1.2-2")," DT"),n(3),_("disabled",e.resteAPayer<=.01),n(),g(" ",e.resteAPayer>.01?d(24,24,"SALAIRES.PAYER"):d(25,26,"SALAIRES.PAYE")," ")}}function Ye(l,t){if(l&1){let e=I();a(0,"div",15)(1,"div",16)(2,"h2"),o(3),c(4,"translate"),r(),a(5,"button",17),c(6,"translate"),v("click",function(){S(e);let s=u(2);return f(s.dernierCalcul=null)}),L(),a(7,"svg",18),E(8,"path",19),r()()(),D(),a(9,"div",20)(10,"div",21)(11,"button",22),v("click",function(){S(e);let s=u(2);return f(s.toggleAccordion("summary"))}),a(12,"span"),o(13),c(14,"translate"),r(),L(),a(15,"svg",23),E(16,"path",24),r()(),D(),a(17,"div",25)(18,"div",26)(19,"div",27)(20,"span"),o(21),c(22,"translate"),r(),a(23,"strong",28),o(24),c(25,"number"),a(26,"button",29),v("click",function(){S(e);let s=u(2);return f(s.showRevenueDetails())}),o(27),c(28,"translate"),r()()(),a(29,"div",27)(30,"span"),o(31),c(32,"translate"),r(),a(33,"strong",30),o(34),c(35,"number"),a(36,"button",29),v("click",function(){S(e);let s=u(2);return f(s.showExpenseDetails())}),o(37),c(38,"translate"),r()()(),a(39,"div",27)(40,"span"),o(41),c(42,"translate"),r(),a(43,"strong",31),o(44),c(45,"number"),r()()()()(),a(46,"div",21)(47,"button",22),v("click",function(){S(e);let s=u(2);return f(s.toggleAccordion("sharing"))}),a(48,"span"),o(49),c(50,"translate"),r(),L(),a(51,"svg",23),E(52,"path",24),r()(),D(),a(53,"div",25)(54,"div",26)(55,"div",27)(56,"span"),o(57),c(58,"translate"),r(),a(59,"strong"),o(60),c(61,"number"),r()(),a(62,"div",27)(63,"span"),o(64),c(65,"translate"),r(),a(66,"strong"),o(67),c(68,"number"),r()(),a(69,"div",27)(70,"span"),o(71,"- D\xE9ductions"),r(),a(72,"strong",30),o(73),c(74,"number"),r()(),a(75,"div",32)(76,"span"),o(77),c(78,"translate"),r(),a(79,"strong"),o(80),c(81,"number"),r()()()()(),a(82,"div",21)(83,"button",22),v("click",function(){S(e);let s=u(2);return f(s.toggleAccordion("details"))}),a(84,"span"),o(85),c(86,"translate"),r(),L(),a(87,"svg",23),E(88,"path",24),r()(),D(),a(89,"div",25)(90,"div",33)(91,"table",34)(92,"thead")(93,"tr")(94,"th"),o(95),c(96,"translate"),r(),a(97,"th"),o(98),c(99,"translate"),r(),a(100,"th"),o(101),c(102,"translate"),r(),a(103,"th"),o(104),c(105,"translate"),r(),a(106,"th"),o(107),c(108,"translate"),r(),a(109,"th"),o(110),c(111,"translate"),r(),a(112,"th",35),o(113),c(114,"translate"),r(),a(115,"th"),o(116),c(117,"translate"),r()()(),a(118,"tbody"),M(119,$e,26,28,"tr",36),r()()()()()()()}if(l&2){let e=u(2);n(3),z("",d(4,42,"SALAIRES.RESULTS.TITLE")," : ",e.dernierCalcul.sortiesDestinations.join(", ")),n(2),_("title",d(6,44,"SALAIRES.RESULTS.CLOSE")),n(8),m(d(14,46,"SALAIRES.RESULTS.FINANCIAL_SUMMARY")),n(2),P("rotate",e.accordionState.summary),n(2),P("open",e.accordionState.summary),n(4),m(d(22,48,"SALAIRES.REVENU_TOTAL")),n(3),g(" ",C(25,50,e.dernierCalcul.revenuTotal,"1.2-2")," DT "),n(3),g("(",d(28,53,"COMMON.VIEW_DETAILS"),")"),n(4),m(d(32,55,"SALAIRES.TOTAL_DEPENSES")),n(3),g(" ",C(35,57,e.dernierCalcul.totalDepenses,"1.2-2")," DT "),n(3),g("(",d(38,60,"COMMON.VIEW_DETAILS"),")"),n(4),m(d(42,62,"SALAIRES.BENEFICE_NET")),n(3),g("",C(45,64,e.dernierCalcul.beneficeNet,"1.2-2")," DT"),n(5),m(d(50,67,"SALAIRES.RESULTS.PROFIT_SHARING")),n(2),P("rotate",e.accordionState.sharing),n(2),P("open",e.accordionState.sharing),n(4),m(d(58,69,"SALAIRES.PART_PROPRIETAIRE")),n(3),g("",C(61,71,e.dernierCalcul.partProprietaire,"1.2-2")," DT"),n(4),m(d(65,74,"SALAIRES.PART_EQUIPAGE")),n(3),g("",C(68,76,e.dernierCalcul.partEquipage,"1.2-2")," DT"),n(6),g("",C(74,79,e.dernierCalcul.deductionNuits,"1.2-2")," DT"),n(4),m(d(78,82,"SALAIRES.MONTANT_A_PARTAGER")),n(3),g("",C(81,84,e.dernierCalcul.montantAPartager,"1.2-2")," DT"),n(5),m(d(86,87,"SALAIRES.DETAILS_PAR_MARIN")),n(2),P("rotate",e.accordionState.details),n(2),P("open",e.accordionState.details),n(6),m(d(96,89,"SAILORS.TITLE")),n(3),m(d(99,91,"SAILORS.PART")),n(3),m(d(102,93,"SALAIRES.SALAIRE_BASE")),n(3),m(d(105,95,"SALAIRES.PRIME_NUITS")),n(3),m(d(108,97,"AVANCES.TITLE")),n(3),m(d(111,99,"SALAIRES.DEJA_PAYE")),n(3),m(d(114,101,"SALAIRES.RESTE_A_PAYER")),n(3),m(d(117,103,"BOATS.ACTIONS")),n(3),_("ngForOf",e.dernierCalcul.detailsMarins)}}function ze(l,t){if(l&1){let e=I();a(0,"div",49),v("click",function(){let s=S(e).$implicit,b=u(5);return f(b.toggleSortie(s.id))}),a(1,"input",50),v("click",function(s){return S(e),f(s.stopPropagation())}),r(),a(2,"div",51)(3,"strong"),o(4),r(),a(5,"span"),o(6),r()()()}if(l&2){let e=t.$implicit,i=u(5);P("selected",i.isSortieSelected(e.id)),n(),_("checked",i.isSortieSelected(e.id)),n(3),m(e.destination),n(2),z("",i.formatDate(e.dateDepart)," - ",i.formatDate(e.dateRetour))}}function Ge(l,t){if(l&1&&(a(0,"div",47),M(1,ze,7,6,"div",48),r()),l&2){let e=u(4);n(),_("ngForOf",e.sortiesOuvertes)}}function qe(l,t){l&1&&(a(0,"div",52)(1,"p"),o(2),c(3,"translate"),r()()),l&2&&(n(2),m(d(3,1,"SALAIRES.NO_OPEN_TRIPS")))}function He(l,t){if(l&1){let e=I();a(0,"div",42)(1,"div",43)(2,"h2"),o(3),c(4,"translate"),r(),M(5,Ge,2,1,"div",44)(6,qe,4,3,"ng-template",null,0,ee),a(8,"button",45),v("click",function(){S(e);let s=u(3);return f(s.calculerSalaires())}),L(),a(9,"svg",18),E(10,"path",46),r(),o(11),c(12,"translate"),r()()()}if(l&2){let e=Z(7),i=u(3);n(3),m(d(4,5,"SORTIES.SELECTSORTIES")),n(2),_("ngIf",i.sortiesOuvertes.length>0)("ngIfElse",e),n(3),_("disabled",i.selectedSortiesIds.length===0||i.marins.length===0),n(3),g(" ",d(12,7,"SALAIRES.CALCULER")," ")}}function Xe(l,t){if(l&1){let e=I();a(0,"div",56)(1,"div",51)(2,"strong"),o(3),r(),a(4,"span"),o(5),r()(),a(6,"button",57),v("click",function(){let s=S(e).$implicit,b=u(5);return f(b.viewCalculDetails(s))}),o(7),c(8,"translate"),r()()}if(l&2){let e=t.$implicit,i=u(5);n(3),m(e.destination),n(2),z("",i.formatDate(e.dateDepart)," - ",i.formatDate(e.dateRetour)),n(2),m(d(8,4,"COMMON.VIEW_DETAILS"))}}function We(l,t){if(l&1&&(a(0,"div",54),M(1,Xe,9,6,"div",55),r()),l&2){let e=u(4);n(),_("ngForOf",e.sortiesCalculees)}}function Qe(l,t){l&1&&(a(0,"div",52)(1,"p"),o(2),c(3,"translate"),r()()),l&2&&(n(2),m(d(3,1,"SALAIRES.NO_CALCULATED_TRIPS")))}function Je(l,t){if(l&1&&(a(0,"div",42)(1,"div",43)(2,"h2"),o(3),c(4,"translate"),r(),M(5,We,2,1,"div",53)(6,Qe,4,3,"ng-template",null,1,ee),r()()),l&2){let e=Z(7),i=u(3);n(3),m(d(4,3,"SALAIRES.TABS.CALCULATED_TRIPS")),n(2),_("ngIf",i.sortiesCalculees.length>0)("ngIfElse",e)}}function Ke(l,t){if(l&1&&(a(0,"div"),M(1,He,13,9,"div",41)(2,Je,8,5,"div",41),r()),l&2){let e=u(2);n(),_("ngIf",e.activeTab==="ouvertes"),n(),_("ngIf",e.activeTab==="historique")}}function Ze(l,t){if(l&1){let e=I();a(0,"div",9)(1,"div",10)(2,"button",11),v("click",function(){S(e);let s=u();return f(s.selectTab("ouvertes"))}),o(3),c(4,"translate"),a(5,"span",12),o(6),r()(),a(7,"button",11),v("click",function(){S(e);let s=u();return f(s.selectTab("historique"))}),o(8),c(9,"translate"),a(10,"span",12),o(11),r()()(),M(12,Ye,120,105,"div",13)(13,Ke,3,2,"div",14),r()}if(l&2){let e=u();n(2),P("active",e.activeTab==="ouvertes"),n(),g(" ",d(4,10,"SALAIRES.TABS.OPEN_TRIPS")," "),n(3),m(e.sortiesOuvertes.length),n(),P("active",e.activeTab==="historique"),n(),g(" ",d(9,12,"SALAIRES.TABS.HISTORY")," "),n(3),m(e.sortiesCalculees.length),n(),_("ngIf",e.dernierCalcul),n(),_("ngIf",!e.dernierCalcul)}}var R=class R{constructor(t,e,i,s,b,F,te,W,Q,j){this.sortieService=t;this.marinService=e;this.depenseService=i;this.avanceService=s;this.paiementService=b;this.factureService=F;this.salaireService=te;this.selectedBoatService=W;this.alertService=Q;this.translate=j;this.selectedBoat=null;this.marins=[];this.selectedSortiesIds=[];this.activeTab="ouvertes";this.sortiesOuvertes=[];this.sortiesCalculees=[];this.historiqueCalculs={};this.dernierCalcul=null;this.accordionState={summary:!0,sharing:!0,details:!0};this.loading=!0}ngOnInit(){this.selectedBoat=this.selectedBoatService.getSelectedBoat(),this.selectedBoat?this.loadData():this.loading=!1}loadData(){if(!this.selectedBoat?.id)return;this.loading=!0;let t=this.selectedBoat.id;this.sortieService.getSortiesByBateau(t).subscribe(e=>{this.sortiesOuvertes=e.filter(i=>i.statut==="terminee"&&!i.salaireCalcule),this.sortiesCalculees=e.filter(i=>i.salaireCalcule===!0).sort((i,s)=>{let b=i.dateRetour.toDate?i.dateRetour.toDate().getTime():new Date(i.dateRetour).getTime();return(s.dateRetour.toDate?s.dateRetour.toDate().getTime():new Date(s.dateRetour).getTime())-b}),this.marinService.getMarinsByBateau(t).subscribe(i=>{this.marins=i,this.loading=!1})})}selectTab(t){this.activeTab=t,this.dernierCalcul=null}toggleSortie(t){this.dernierCalcul=null;let e=this.selectedSortiesIds.indexOf(t);e>-1?this.selectedSortiesIds.splice(e,1):this.selectedSortiesIds.push(t)}isSortieSelected(t){return this.selectedSortiesIds.includes(t)}calculerSalaires(){return h(this,null,function*(){if(this.selectedSortiesIds.length===0){this.alertService.error(this.translate.instant("SALAIRES.ERROR_NO_SORTIE"));return}let t=this.marins.reduce((e,i)=>e+(i.part||0),0);if(t<=0){this.alertService.error(this.translate.instant("SALAIRES.ERROR_NO_PARTS"));return}try{this.alertService.loading(this.translate.instant("MESSAGES.CALCULATING"));let i=[...this.sortiesOuvertes,...this.sortiesCalculees].filter(p=>this.selectedSortiesIds.includes(p.id)),s=this.selectedSortiesIds.map(p=>this.factureService.getFacturesBySortie(p).pipe(w(1)).toPromise()),b=yield Promise.all(s),F=b.flat().reduce((p,x)=>p+(x?.montant||0),0),te=this.selectedSortiesIds.map(p=>this.depenseService.getDepensesBySortie(p).pipe(w(1)).toPromise()),W=yield Promise.all(te),Q=W.flat().reduce((p,x)=>p+(x?.montant||0),0),j=F-Q,De=j*.5,ne=j*.5,ie=i.reduce((p,x)=>p+this.calculerNombreNuits(x),0),ae=ie*this.marins.length*5,re=ne-ae,oe=[];for(let p of this.marins){let x=p.part||0,ce=t>0?re*x/t:0,le=ie*5,de=(yield this.avanceService.getAvancesByMarin(p.id).pipe(w(1)).toPromise())?.reduce((J,K)=>J+K.montant,0)||0,me=(yield this.paiementService.getPaiementsByMarin(p.id).pipe(w(1)).toPromise())?.reduce((J,K)=>J+K.montant,0)||0,Be=ce+le-de-me;oe.push({marinId:p.id,marinNom:`${p.prenom} ${p.nom}`,part:x,salaireBrut:ce,primeNuits:le,totalAvances:de,totalPaiements:me,resteAPayer:Be})}let se={bateauId:this.selectedBoat.id,sortiesIds:this.selectedSortiesIds,sortiesDestinations:i.map(p=>p.destination),dateCalcul:new Date,revenuTotal:F,totalDepenses:Q,beneficeNet:j,partProprietaire:De,partEquipage:ne,deductionNuits:ae,montantAPartager:re,detailsMarins:oe,factures:b.flat(),depenses:W.flat()};yield this.salaireService.saveCalculSalaire(se);for(let p of this.selectedSortiesIds)yield this.sortieService.updateSortie(p,{salaireCalcule:!0});this.alertService.close(),this.dernierCalcul=se,this.accordionState={summary:!0,sharing:!0,details:!0},this.selectedSortiesIds=[],this.loadData(),this.alertService.toast(this.translate.instant("SALAIRES.CALCUL_SUCCESS_TITLE"),"success")}catch(e){console.error("Erreur:",e),this.alertService.close(),this.alertService.error()}})}viewCalculDetails(t){return h(this,null,function*(){if(this.alertService.loading(this.translate.instant("MESSAGES.LOADING_DETAILS")),this.historiqueCalculs[t.id]){this.displayCalculInView(this.historiqueCalculs[t.id][0]);return}this.salaireService.getCalculsBySortieId(t.id).pipe(w(1)).subscribe({next:e=>h(this,null,function*(){e&&e.length>0?(this.historiqueCalculs[t.id]=e,this.displayCalculInView(e[0])):(this.alertService.close(),(yield V.default.fire({title:this.translate.instant("SALAIRES.HISTORY.NO_DATA_FOUND_TITLE"),text:this.translate.instant("SALAIRES.HISTORY.NO_DATA_FOUND_TEXT"),icon:"info",showCancelButton:!0,confirmButtonText:this.translate.instant("SALAIRES.HISTORY.RECALCULATE_BTN"),cancelButtonText:this.translate.instant("FORM.CANCEL"),confirmButtonColor:"#10b981"})).isConfirmed&&(yield this.reopenSortieForRecalculation(t)))}),error:e=>{console.error(e),this.alertService.error()}})})}reopenSortieForRecalculation(t){return h(this,null,function*(){try{this.alertService.loading(this.translate.instant("MESSAGES.UPDATING")),yield this.sortieService.updateSortie(t.id,{salaireCalcule:!1}),this.loadData(),this.activeTab="ouvertes",this.alertService.success(this.translate.instant("SALAIRES.HISTORY.MOVED_FOR_RECALC"))}catch(e){console.error(e),this.alertService.error()}})}displayCalculInView(t){this.dernierCalcul=t,this.accordionState={summary:!0,sharing:!0,details:!0},this.activeTab="historique",this.alertService.close(),window.scrollTo({top:0,behavior:"smooth"})}showRevenueDetails(){if(!this.dernierCalcul||!this.dernierCalcul.factures)return;let t={title:this.translate.instant("SALAIRES.DETAILS_MODAL.REVENUE_TITLE"),invoiceNum:this.translate.instant("SALAIRES.DETAILS_MODAL.INVOICE_NUM"),client:this.translate.instant("SALAIRES.DETAILS_MODAL.CLIENT"),date:this.translate.instant("COMMON.DATE"),amount:this.translate.instant("COMMON.AMOUNT")},e=this.dernierCalcul.factures.map(s=>`<tr><td>${s.numeroFacture}</td><td>${s.client}</td><td>${this.formatDate(s.dateVente)}</td><td class="amount">${s.montant.toFixed(2)} DT</td></tr>`).join(""),i=`<div class="details-modal-content"><table class="details-table"><thead><tr><th>${t.invoiceNum}</th><th>${t.client}</th><th>${t.date}</th><th class="amount">${t.amount}</th></tr></thead><tbody>${e}</tbody></table></div>`;V.default.fire({title:t.title,html:i,width:"800px",showCloseButton:!0,showConfirmButton:!1})}showExpenseDetails(){if(!this.dernierCalcul||!this.dernierCalcul.depenses)return;let t={title:this.translate.instant("SALAIRES.DETAILS_MODAL.EXPENSE_TITLE"),type:this.translate.instant("EXPENSES.TYPE"),date:this.translate.instant("COMMON.DATE"),description:this.translate.instant("COMMON.DESCRIPTION"),amount:this.translate.instant("COMMON.AMOUNT")},e=this.dernierCalcul.depenses.map(s=>`<tr><td>${this.translate.instant("EXPENSES.TYPES."+s.type.toUpperCase())}</td><td>${this.formatDate(s.date)}</td><td>${s.description||"-"}</td><td class="amount">${s.montant.toFixed(2)} DT</td></tr>`).join(""),i=`<div class="details-modal-content"><table class="details-table"><thead><tr><th>${t.type}</th><th>${t.date}</th><th>${t.description}</th><th class="amount">${t.amount}</th></tr></thead><tbody>${e}</tbody></table></div>`;V.default.fire({title:t.title,html:i,width:"800px",showCloseButton:!0,showConfirmButton:!1})}enregistrerPaiement(t){return h(this,null,function*(){let{value:e}=yield V.default.fire({title:this.translate.instant("SALAIRES.PAYMENT_MODAL_TITLE",{name:t.marinNom}),input:"number",inputLabel:this.translate.instant("SALAIRES.PAYMENT_MODAL_LABEL",{amount:t.resteAPayer.toFixed(2)}),inputValue:t.resteAPayer>0?t.resteAPayer.toFixed(2):0,showCancelButton:!0,confirmButtonText:this.translate.instant("FORM.SAVE"),cancelButtonText:this.translate.instant("FORM.CANCEL"),confirmButtonColor:"#10b981",inputValidator:i=>{if(!i)return this.translate.instant("FORM.REQUIRED");let s=parseFloat(i);return s<=0?this.translate.instant("SALAIRES.PAYMENTMODAL.ERRORPOSITIVE"):s>t.resteAPayer+.01?this.translate.instant("SALAIRES.PAYMENTMODAL.ERROREXCEED"):null}});if(e)try{this.alertService.loading(this.translate.instant("MESSAGES.SAVING"));let i=parseFloat(e);yield this.paiementService.addPaiement({marinId:t.marinId,montant:i,datePaiement:new Date,sortiesIds:this.dernierCalcul.sortiesIds}),t.totalPaiements+=i;let s=t.salaireBrut+t.primeNuits;t.resteAPayer=s-t.totalAvances-t.totalPaiements,Math.abs(t.resteAPayer)<.01&&(t.resteAPayer=0),this.dernierCalcul&&this.dernierCalcul.id&&(yield this.salaireService.updateCalculSalaire(this.dernierCalcul.id,{detailsMarins:this.dernierCalcul.detailsMarins})),this.alertService.success(this.translate.instant("SALAIRES.PAYMENT_SUCCESS"))}catch(i){console.error("Erreur:",i),this.alertService.error()}})}calculerNombreNuits(t){if(!t?.dateDepart||!t?.dateRetour)return 0;let e=t.dateDepart.toDate?t.dateDepart.toDate():new Date(t.dateDepart),i=t.dateRetour.toDate?t.dateRetour.toDate():new Date(t.dateRetour),s=Math.abs(i.getTime()-e.getTime());return Math.ceil(s/(1e3*60*60*24))}formatDate(t){return t?.toDate?t.toDate().toLocaleDateString("fr-FR"):t instanceof Date?t.toLocaleDateString("fr-FR"):""}toggleAccordion(t){this.accordionState[t]=!this.accordionState[t]}};R.\u0275fac=function(e){return new(e||R)(O(ye),O(Ee),O(Ie),O(we),O(H),O(Ae),O(X),O(Oe),O(Te),O(Ce))},R.\u0275cmp=ue({type:R,selectors:[["app-salaires-list"]],decls:7,vars:5,consts:[["noOpenTrips",""],["noCalculatedTrips",""],[1,"salaires-container"],[1,"header"],[1,"title"],["class","loading",4,"ngIf"],["class","content",4,"ngIf"],[1,"loading"],[1,"spinner"],[1,"content"],[1,"tabs"],[1,"tab-button",3,"click"],[1,"badge"],["class","results-container",4,"ngIf"],[4,"ngIf"],[1,"results-container"],[1,"results-header"],[1,"btn-close-results",3,"click","title"],["fill","none","viewBox","0 0 24 24","stroke","currentColor"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"accordion"],[1,"accordion-item"],[1,"accordion-header",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"chevron"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"accordion-content"],[1,"summary-grid"],[1,"summary-item"],[1,"revenue"],[1,"details-link",3,"click"],[1,"expenses"],[1,"benefit"],[1,"summary-item","net-share"],[1,"table-container"],[1,"salaires-table"],[1,"reste"],[4,"ngFor","ngForOf"],[1,"marin-name"],[1,"avances"],[1,"paiements"],[1,"btn","btn-sm","btn-pay",3,"click","disabled"],["class","tab-content",4,"ngIf"],[1,"tab-content"],[1,"section-card"],["class","sorties-list",4,"ngIf","ngIfElse"],[1,"btn","btn-success","btn-lg",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"],[1,"sorties-list"],["class","sortie-item",3,"selected","click",4,"ngFor","ngForOf"],[1,"sortie-item",3,"click"],["type","checkbox",3,"click","checked"],[1,"sortie-info"],[1,"no-data-small"],["class","sorties-list-history",4,"ngIf","ngIfElse"],[1,"sorties-list-history"],["class","sortie-item-history",4,"ngFor","ngForOf"],[1,"sortie-item-history"],[1,"btn","btn-secondary","btn-sm",3,"click"]],template:function(e,i){e&1&&(a(0,"div",2)(1,"div",3)(2,"h1",4),o(3),c(4,"translate"),r()(),M(5,Ue,5,3,"div",5)(6,Ze,14,14,"div",6),r()),e&2&&(n(3),m(d(4,3,"SALAIRES.TITLE")),n(2),_("ngIf",i.loading),n(),_("ngIf",!i.loading&&i.selectedBoat))},dependencies:[fe,ge,_e,ve,he,Se,be],styles:['@charset "UTF-8";.salaires-container[_ngcontent-%COMP%]{max-width:1600px;margin:0 auto;padding:2rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;flex-wrap:wrap;gap:1rem}.title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#1f2937;margin:0}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;border:none;border-radius:.5rem;font-weight:600;cursor:pointer;transition:all .3s}.btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2563eb;transform:translateY(-2px)}.btn-success[_ngcontent-%COMP%]{background-color:#10b981;color:#fff}.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#059669;transform:translateY(-2px)}.btn-lg[_ngcontent-%COMP%]{padding:1rem 2rem;font-size:1.125rem;margin-top:1.5rem}.btn-sm[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.875rem}.btn-pay[_ngcontent-%COMP%]{background-color:#10b981;color:#fff}.btn-pay[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#059669}.btn-pay[_ngcontent-%COMP%]:disabled{background-color:#9ca3af}.loading[_ngcontent-%COMP%]{text-align:center;padding:3rem}.loading[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;margin:0 auto 1rem;border:4px solid #f3f4f6;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.no-data[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#9ca3af}.no-data[_ngcontent-%COMP%]   .no-data-icon[_ngcontent-%COMP%]{width:64px;height:64px;margin:0 auto 1rem;opacity:.5}.section-card[_ngcontent-%COMP%]{background:#fff;border-radius:.75rem;padding:2rem;box-shadow:0 1px 3px #0000001a;margin-bottom:2rem}.section-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#1f2937;margin:0 0 1.5rem}.sorties-list[_ngcontent-%COMP%]{display:grid;gap:1rem;margin-bottom:1.5rem}.sortie-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;border:2px solid #e5e7eb;border-radius:.5rem;cursor:pointer;transition:all .3s}.sortie-item[_ngcontent-%COMP%]:hover{border-color:#3b82f6;background-color:#f9fafb}.sortie-item.selected[_ngcontent-%COMP%]{border-color:#10b981;background-color:#d1fae5}.sortie-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:20px;height:20px}.sortie-item[_ngcontent-%COMP%]   .sortie-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.sortie-item[_ngcontent-%COMP%]   .sortie-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#1f2937}.sortie-item[_ngcontent-%COMP%]   .sortie-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280}.sortie-item[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:.375rem;font-size:.875rem;font-weight:600}.sortie-item[_ngcontent-%COMP%]   .status-en-cours[_ngcontent-%COMP%]{background-color:#dbeafe;color:#1e40af}.sortie-item[_ngcontent-%COMP%]   .status-terminee[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-bottom:2rem}.summary-card[_ngcontent-%COMP%]{background:#fff;border-radius:.75rem;padding:1.5rem;box-shadow:0 1px 3px #0000001a}.summary-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#6b7280;margin:0 0 .5rem;text-transform:uppercase;letter-spacing:.05em}.summary-card[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;margin:0}.summary-card[_ngcontent-%COMP%]   .amount.big[_ngcontent-%COMP%]{font-size:2.25rem}.summary-card[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280;margin:.25rem 0 0}.summary-card.revenue[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:#10b981}.summary-card.expenses[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:#ef4444}.summary-card.benefit[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:#3b82f6}.summary-card.owner[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}.summary-card.owner[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .summary-card.owner[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:#fff}.summary-card.crew[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);color:#fff}.summary-card.crew[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .summary-card.crew[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%], .summary-card.crew[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]{color:#fff}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.salaires-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.salaires-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#f9fafb}.salaires-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;font-weight:600;color:#374151;border-bottom:2px solid #e5e7eb;white-space:nowrap}.salaires-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th.reste[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #e5e7eb}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;color:#6b7280}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.marin-name[_ngcontent-%COMP%]{font-weight:600;color:#1f2937}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.avances[_ngcontent-%COMP%]{color:#ef4444}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.paiements[_ngcontent-%COMP%]{color:#3b82f6}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.reste[_ngcontent-%COMP%]{background-color:#f0fdf4;font-size:1.125rem}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.reste[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#059669}.salaires-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.reste.paid[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#9ca3af}@media (max-width: 768px){.salaires-container[_ngcontent-%COMP%]{padding:1rem}.title[_ngcontent-%COMP%]{font-size:1.5rem}.summary-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}.table-container[_ngcontent-%COMP%]{overflow-x:scroll}.salaires-table[_ngcontent-%COMP%]{font-size:.875rem}}.tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;border-bottom:2px solid #e5e7eb;margin-bottom:2rem}.tab-button[_ngcontent-%COMP%]{padding:1rem 1.5rem;border:none;background:none;font-size:1rem;font-weight:600;color:#6b7280;cursor:pointer;transition:all .3s;border-bottom:4px solid transparent;display:flex;align-items:center;gap:.5rem}.tab-button[_ngcontent-%COMP%]:hover{color:#1f2937;background-color:#f9fafb}.tab-button.active[_ngcontent-%COMP%]{color:#10b981;border-bottom-color:#10b981}.badge[_ngcontent-%COMP%]{background-color:#e5e7eb;color:#4b5563;border-radius:9999px;padding:.125rem .625rem;font-size:.75rem;font-weight:700}.tab-button.active[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background-color:#10b981;color:#fff}.no-data-small[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#9ca3af;font-style:italic}.sorties-list-history[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.sortie-item-history[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#f9fafb;border:1px solid #e5e7eb;border-radius:.5rem}.btn-secondary[_ngcontent-%COMP%]{background-color:#6b7280;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#4b5563}.calcul-details-popup[_ngcontent-%COMP%]   .swal2-html-container[_ngcontent-%COMP%]{padding:0!important;margin:1rem 0 0!important}.swal-calcul-details[_ngcontent-%COMP%]{text-align:left}.swal-calcul-details[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%], .swal-calcul-details[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{margin-bottom:1.5rem}.swal-calcul-details[_ngcontent-%COMP%]   .salaires-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .swal-calcul-details[_ngcontent-%COMP%]   .salaires-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem}.results-container[_ngcontent-%COMP%]{background-color:#f9fafb;border:1px solid #e5e7eb;border-radius:.75rem;padding:1.5rem;margin-top:2rem;animation:_ngcontent-%COMP%_fadeIn .5s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.results-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.results-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:#10b981}.btn-close-results[_ngcontent-%COMP%]{background:#e5e7eb;border:none;border-radius:9999px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.btn-close-results[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px;color:#6b7280}.btn-close-results[_ngcontent-%COMP%]:hover{background:#d1d5db;transform:rotate(90deg)}.accordion[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.accordion-item[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:.5rem;overflow:hidden}.accordion-header[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border:none;background:none;cursor:pointer;font-size:1.125rem;font-weight:600;color:#1f2937}.accordion-header[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{width:20px;height:20px;color:#9ca3af;transition:transform .3s ease}.accordion-header[_ngcontent-%COMP%]   .chevron.rotate[_ngcontent-%COMP%]{transform:rotate(180deg)}.accordion-content[_ngcontent-%COMP%]{max-height:0;overflow:hidden;transition:max-height .4s ease-out,padding .4s ease-out;padding:0 1.5rem}.accordion-content.open[_ngcontent-%COMP%]{max-height:2000px;padding:1.5rem;padding-top:0;transition:max-height .5s ease-in,padding .5s ease-in}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}.summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{background:#f9fafb;padding:1rem;border-radius:.5rem;display:flex;justify-content:space-between;align-items:center}.summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#6b7280}.summary-grid[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.25rem}.summary-grid[_ngcontent-%COMP%]   .summary-item.net-share[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .summary-grid[_ngcontent-%COMP%]   .revenue[_ngcontent-%COMP%]{color:#10b981}.summary-grid[_ngcontent-%COMP%]   .expenses[_ngcontent-%COMP%]{color:#ef4444}.summary-grid[_ngcontent-%COMP%]   .benefit[_ngcontent-%COMP%]{color:#3b82f6}.details-link[_ngcontent-%COMP%]{background:none;border:none;color:#3b82f6;text-decoration:underline;cursor:pointer;font-size:.8rem;margin-left:.5rem;padding:0}.details-link[_ngcontent-%COMP%]:hover{color:#1d4ed8}.summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:flex;align-items:center}.details-modal-content[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto;padding:1rem 0}.details-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.details-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .details-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;text-align:left;border-bottom:1px solid #e5e7eb}.details-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f9fafb;font-weight:600}.details-table[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{text-align:right;font-weight:600;white-space:nowrap}.btn-pay[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.btn-pay[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2563eb}.btn-pay[_ngcontent-%COMP%]:disabled{background-color:#d1d5db;cursor:not-allowed}']});var Re=R;export{Re as SalairesListComponent};
